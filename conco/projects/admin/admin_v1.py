from django.contrib import admin
from django.db.models import Q
from django.db import models
from django.utils.html import format_html
from django.urls import reverse

from projects.models import *


# Media
@admin.register(Media)
class MediaAdmin(admin.ModelAdmin):
    list_display = (
        'id',
        'media_preview',
        'background_flags',
        'created_at',
    )
    list_display_links = ('media_preview',)
    list_filter = (
        'is_home_page_background_image',
        'is_about_page_background_image',
        'is_contact_page_background_image',
        'is_project_page_background_image',
        'is_vacany_page_background_image',
        'is_footer_background_image',
        'created_at',
    )
    readonly_fields = ('created_at', 'media_preview_detailed')

    fieldsets = (
        ('Media FaylÄ±', {
            'fields': ('image', 'media_preview_detailed')
        }),
        ('Arxa Plan TÉ™yinatlarÄ±', {
            'fields': (
                'is_home_page_background_image',
                'is_about_page_background_image',
                'is_contact_page_background_image',
                'is_project_page_background_image',
                'is_vacany_page_background_image',
                'is_footer_background_image',
            ),
        }),
    )

    ordering = ('-created_at',)
    list_per_page = 25

    class Media:
        js = ('assets/js/admin_image_compress.js',)

    def get_queryset(self, request):
        qs = super().get_queryset(request)
        return qs.filter(
            models.Q(is_home_page_background_image=True) |
            models.Q(is_about_page_background_image=True) |
            models.Q(is_contact_page_background_image=True) |
            models.Q(is_project_page_background_image=True) |
            models.Q(is_vacany_page_background_image=True)  |
            models.Q(is_footer_background_image=True)
        )

    def media_preview(self, obj):
        if obj.image:
            return format_html(
                '<img src="{}" style="max-width: 80px; max-height: 80px; border-radius: 4px;" />',
                obj.image.url
            )
        return "-"
    media_preview.short_description = "ÅÉ™kil"

    def media_preview_detailed(self, obj):
        if obj.image:
            return format_html(
                '<img src="{}" style="max-width: 300px; max-height: 300px; border-radius: 8px;" />',
                obj.image.url
            )
        return "-"
    media_preview_detailed.short_description = "ÅÉ™kil Ã–nizlÉ™mÉ™"

    def background_flags(self, obj):
        flags = []
        if obj.is_home_page_background_image:
            flags.append("ğŸ  Ana sÉ™hifÉ™")
        if obj.is_about_page_background_image:
            flags.append("â„¹ï¸ HaqqÄ±mÄ±zda sÉ™hifÉ™si")
        if obj.is_contact_page_background_image:
            flags.append("ğŸ¤ ÆlaqÉ™ sÉ™hifÉ™i")
        if obj.is_project_page_background_image:
            flags.append("ğŸ“ LayihÉ™lÉ™r sÉ™hifÉ™si")
        if obj.is_vacany_page_background_image:
            flags.append("ğŸ’¼ Vakansiyalar sÉ™hifÉ™si")
        if obj.is_footer_background_image:
            flags.append("ğŸ–¼ï¸ Websiten-Ä±n aÅŸaÄŸÄ± hissÉ™si Ã¼Ã§Ã¼n")
        return " | ".join(flags) if flags else "-"
    background_flags.short_description = "Arxa Plan"



class MediaInlineBase(admin.TabularInline):
    model = Media
    extra = 1
    readonly_fields = ('created_at', 'thumbnail_preview')
    fields = ('image', 'video', 'thumbnail_preview', 'created_at')
    verbose_name = "Media"
    verbose_name_plural = "Medialar"
    
    class Media:
        js = ('assets/js/admin_image_compress.js',)
    
    def thumbnail_preview(self, obj):
        if obj and obj.image:
            return format_html(
                '<img src="{}" style="max-width: 60px; max-height: 60px; border-radius: 4px;" />',
                obj.image.url
            )
        return "-"
    thumbnail_preview.short_description = "Ã–nizlÉ™mÉ™"


class MediaInlineProject(MediaInlineBase):
    fields = ('image', 'video', 'thumbnail_preview', 'created_at')


class MediaInlinePartner(MediaInlineBase):
    fields = ('image', 'thumbnail_preview', 'created_at')


class MediaInlineAbout(MediaInlineBase):
    fields = ('image', 'thumbnail_preview', 'created_at')


class MediaInlineVacancy(MediaInlineBase):
    max_num = 1
    fields = ('image', 'thumbnail_preview', 'created_at')  

# Project Category 
@admin.register(ProjectCategory)
class ProjectCategoryAdmin(admin.ModelAdmin):
    list_display = ('id', 'name_link', 'name_en', 'name_ru', 'projects_count')
    list_display_links = None
    search_fields = ('name_az', 'name_en', 'name_ru')
    list_per_page = 25
    
    fieldsets = (
        ('AzÉ™rbaycan', {
            'fields': ('name_az',)
        }),
        ('English', {
            'fields': ('name_en',)
        }),
        ('Ğ ÑƒÑÑĞºĞ¸Ğ¹', {
            'fields': ('name_ru',)
        }),
    )
    
    def name_link(self, obj):
        url = reverse('admin:projects_projectcategory_change', args=[obj.pk])
        name = obj.name_az or 'Kateqoriya'
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, name)
    name_link.short_description = "Ad (AZ)"
    name_link.admin_order_field = 'name_az'
    
    def projects_count(self, obj):
        count = obj.projects.count()
        if count > 0:
            url = reverse('admin:projects_project_changelist') + f'?category__id__exact={obj.id}'
            return format_html('<a href="{}" style="color: #28a745; text-decoration: none;">ğŸ“ {} layihÉ™</a>', url, count)
        return "0 layihÉ™"
    projects_count.short_description = "LayihÉ™lÉ™r"

# Project 
@admin.register(Project)
class ProjectAdmin(admin.ModelAdmin):
    list_display = (
        'id',
        'name_link',
        'category',
        'status_badges',
        'created_at',
    )
    list_display_links = None
    list_filter = (
        'category',
        'is_completed',
        'is_active',
        'created_at',
    )
    search_fields = ('name_az', 'name_en', 'name_ru', 'description_az', 'description_en', 'description_ru')
    exclude = ('slug',)
    inlines = [MediaInlineProject]
    readonly_fields = ('created_at',)
    ordering = ('-created_at',)
    list_per_page = 25
    
    fieldsets = (
        ('Æsas MÉ™lumatlar', {
            'fields': ('category', 'url')
        }),
        ('AzÉ™rbaycan', {
            'fields': ('name_az', 'description_az')
        }),
        ('English', {
            'fields': ('name_en', 'description_en')
        }),
        ('Ğ ÑƒÑÑĞºĞ¸Ğ¹', {
            'fields': ('name_ru', 'description_ru')
        }),
        ('Status', {
            'fields': ('is_completed', 'is_active')
        }),
        ('Tarix', {
            'fields': ('created_at',)
        }),
    )
    
    def name_link(self, obj):
        url = reverse('admin:projects_project_change', args=[obj.pk])
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, obj.name_az)
    name_link.short_description = "LayihÉ™ AdÄ±"
    name_link.admin_order_field = 'name_az'
    
    def status_badges(self, obj):
        badges = []
        if obj.is_active:
            badges.append('<span style="background: #28a745; color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ“ Aktiv</span>')
        else:
            badges.append('<span style="background: #dc3545; color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ— Deaktiv</span>')
        
        if obj.is_completed:
            badges.append('<span style="background: #17a2b8; color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ“ TamamlanÄ±b</span>')
        else:
            badges.append('<span style="background: #ffc107; color: #333; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">ğŸ”„ Davam edir</span>')
        
        return format_html(' '.join(badges))
    status_badges.short_description = "Status"

# Partner 
@admin.register(Partner)
class PartnerAdmin(admin.ModelAdmin):
    list_display = (
        'id',
        'partner_logo',
        'name_link',
        'url_link',
        'active_status',
        'created_at',
    )
    list_display_links = None
    list_filter = ('is_active', 'created_at')
    search_fields = ('name_az', 'name_en', 'name_ru')
    ordering = ('-created_at',)
    inlines = [MediaInlinePartner]
    readonly_fields = ('created_at', 'logo_preview')
    list_per_page = 25
    
    fieldsets = (
        ('AzÉ™rbaycan', {
            'fields': ('name_az',)
        }),
        ('English', {
            'fields': ('name_en',)
        }),
        ('Ğ ÑƒÑÑĞºĞ¸Ğ¹', {
            'fields': ('name_ru',)
        }),
        ('ÆlaqÉ™', {
            'fields': ('url',)
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Media', {
            'fields': ('logo_preview',)
        }),
        ('Tarix', {
            'fields': ('created_at',)
        }),
    )
    
    def partner_logo(self, obj):
        media = obj.medias.first()
        if media and media.image:
            return format_html(
                '<img src="{}" style="max-width: 60px; max-height: 60px; border-radius: 4px; object-fit: contain;" />',
                media.image.url
            )
        return "âŒ"
    partner_logo.short_description = "Logo"
    
    def name_link(self, obj):
        url = reverse('admin:projects_partner_change', args=[obj.pk])
        name = obj.name_az or 'ÆmÉ™kdaÅŸ'
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, name)
    name_link.short_description = "Ad"
    name_link.admin_order_field = 'name_az'
    
    def logo_preview(self, obj):
        media = obj.medias.first()
        if media and media.image:
            return format_html(
                '<img src="{}" style="max-width: 250px; max-height: 250px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />',
                media.image.url
            )
        return "Logo yoxdur"
    logo_preview.short_description = "Logo Ã–nizlÉ™mÉ™"
    
    def url_link(self, obj):
        if obj.url:
            return format_html('<a href="{}" target="_blank" style="color: #417690; text-decoration: none;">ğŸ”— Link</a>', obj.url)
        return "-"
    url_link.short_description = "URL"
    
    def active_status(self, obj):
        if obj.is_active:
            return format_html('<span style="background: #28a745; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ“ Aktiv</span>')
        return format_html('<span style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ— Deaktiv</span>')
    active_status.short_description = "Status"

# About 
@admin.register(About)
class AboutAdmin(admin.ModelAdmin):
    list_display = ('id', 'title_link', 'second_title_az', 'media_count', 'updated_info')
    list_display_links = None
    search_fields = ('main_title_az', 'main_title_en', 'main_title_ru', 'second_title_az', 'second_title_en', 'second_title_ru', 'description_az', 'description_en', 'description_ru')
    inlines = [MediaInlineAbout]
    list_per_page = 25
    
    fieldsets = (
        ('Æsas BaÅŸlÄ±q', {
            'fields': ('main_title_az', 'main_title_en', 'main_title_ru')
        }),
        ('Alt BaÅŸlÄ±q', {
            'fields': ('second_title_az', 'second_title_en', 'second_title_ru')
        }),
        ('TÉ™svir - AzÉ™rbaycan', {
            'fields': ('description_az',)
        }),
        ('TÉ™svir - English', {
            'fields': ('description_en',)
        }),
        ('TÉ™svir - Ğ ÑƒÑÑĞºĞ¸Ğ¹', {
            'fields': ('description_ru',)
        }),
    )
    
    def title_link(self, obj):
        url = reverse('admin:projects_about_change', args=[obj.pk])
        title = obj.main_title_az or 'HaqqÄ±mÄ±zda'
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, title)
    title_link.short_description = "Æsas BaÅŸlÄ±q"
    title_link.admin_order_field = 'main_title_az'
    
    def media_count(self, obj):
        count = obj.medias.count()
        if count > 0:
            return format_html('<span style="background: #007bff; color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“· {} ÅŸÉ™kil</span>', count)
        return "ğŸ“· 0 ÅŸÉ™kil"
    media_count.short_description = "Medialar"
    
    def updated_info(self, obj):
        if hasattr(obj, 'updated_at'):
            return obj.updated_at.strftime('%d.%m.%Y %H:%M') if obj.updated_at else "-"
        return "-"
    updated_info.short_description = "Son YenilÉ™nmÉ™"

# Contact 
@admin.register(Contact)
class ContactAdmin(admin.ModelAdmin):
    list_display = (
        'id',
        'address_link',
        'contact_phone',
        'contact_email',
        'social_links',
    )
    list_display_links = None
    search_fields = (
        'address_az', 'address_en', 'address_ru',
        'phone', 'whatsapp_number',
        'email',
    )
    list_per_page = 25
    
    fieldsets = (
        ('Ãœnvan', {
            'fields': ('address_az', 'address_en', 'address_ru')
        }),
        ('ÆlaqÉ™ NÃ¶mrÉ™lÉ™ri', {
            'fields': ('phone', 'whatsapp_number')
        }),
        ('Email', {
            'fields': ('email',)
        }),
        ('Sosial ÅÉ™bÉ™kÉ™lÉ™r', {
            'fields': ('instagram', 'facebook', 'linkedn')
        }),
    )
    
    def address_link(self, obj):
        url = reverse('admin:projects_contact_change', args=[obj.pk])
        address = obj.address_az or 'ÆlaqÉ™'
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, address[:50] + '...' if len(address) > 50 else address)
    address_link.short_description = "Ãœnvan"
    address_link.admin_order_field = 'address_az'
    
    def contact_phone(self, obj):
        phones = []
        if obj.phone:
            phones.append(format_html('<span style="color: #417690;">ğŸ“ {}</span>', obj.phone))
        if obj.whatsapp_number:
            phones.append(format_html('<span style="color: #25D366;">ğŸ’¬ {}</span>', obj.whatsapp_number))
        return format_html('<br>'.join(phones)) if phones else "-"
    contact_phone.short_description = "Telefonlar"
    
    def contact_email(self, obj):
        if obj.email:
            return format_html('<a href="mailto:{}" style="color: #417690; text-decoration: none;">âœ‰ï¸ {}</a>', obj.email, obj.email)
        return "-"
    contact_email.short_description = "Email"
    
    def social_links(self, obj):
        links = []
        if obj.instagram:
            links.append(format_html('<a href="{}" target="_blank" style="color: #E4405F; margin-right: 8px;">ğŸ“· Instagram</a>', obj.instagram))
        if obj.facebook:
            links.append(format_html('<a href="{}" target="_blank" style="color: #1877F2; margin-right: 8px;">ğŸ‘¥ Facebook</a>', obj.facebook))
        if obj.youtube:
            links.append(format_html('<a href="{}" target="_blank" style="color: #FF0000; margin-right: 8px;">â–¶ï¸ YouTube</a>', obj.youtube))
        if obj.linkedn:
            links.append(format_html('<a href="{}" target="_blank" style="color: #0A66C2; margin-right: 8px;">ğŸ’¼ LinkedIn</a>', obj.linkedn))
        if obj.tiktok:
            links.append(format_html('<a href="{}" target="_blank" style="color: #000000; margin-right: 8px;">ğŸµ TikTok</a>', obj.tiktok))
        return format_html(' '.join(links)) if links else "-"
    social_links.short_description = "Sosial ÅÉ™bÉ™kÉ™lÉ™r"

# Vacancy 
@admin.register(Vacancy)
class VacancyAdmin(admin.ModelAdmin):
    inlines = [MediaInlineVacancy]
    list_display = (
        'id',
        'title_link',
        'vacancy_status',
        'appeals_count',
        'created_at',
    )
    list_display_links = None
    list_filter = ('is_active', 'created_at')
    search_fields = ('title_az', 'title_en', 'title_ru', 'description_az', 'description_en', 'description_ru')
    exclude = ('slug',)
    readonly_fields = ('created_at',)
    ordering = ('-created_at',)
    list_per_page = 25
    
    fieldsets = (
        ('AzÉ™rbaycan', {
            'fields': ('title_az', 'description_az')
        }),
        ('English', {
            'fields': ('title_en', 'description_en')
        }),
        ('Ğ ÑƒÑÑĞºĞ¸Ğ¹', {
            'fields': ('title_ru', 'description_ru')
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Tarix', {
            'fields': ('created_at',)
        }),
    )
    
    def title_link(self, obj):
        url = reverse('admin:projects_vacancy_change', args=[obj.pk])
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, obj.title_az)
    title_link.short_description = "Vakansiya AdÄ±"
    title_link.admin_order_field = 'title_az'
    
    def vacancy_status(self, obj):
        if obj.is_active:
            return format_html('<span style="background: #28a745; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ“ Aktiv</span>')
        return format_html('<span style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">âœ— Deaktiv</span>')
    vacancy_status.short_description = "Status"
    
    def appeals_count(self, obj):
        count = obj.appeal_set.count()
        read_count = obj.appeal_set.filter(is_read=True).count()
        unread_count = count - read_count
        
        if count > 0:
            url = reverse('admin:projects_appeal_changelist') + f'?vacancy__id__exact={obj.id}'
            badge_html = f'<a href="{url}" style="text-decoration: none;">'
            if unread_count > 0:
                badge_html += f'<span style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">ğŸ“„ {count} CV ({unread_count} oxunmayÄ±b)</span>'
            else:
                badge_html += f'<span style="background: #28a745; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">ğŸ“„ {count} CV (hamÄ±sÄ± oxunub)</span>'
            badge_html += '</a>'
            return format_html(badge_html)
        return format_html('<span style="color: #6c757d;">ğŸ“„ 0 CV</span>')
    appeals_count.short_description = "CV-lÉ™r"

# Motto
@admin.register(Motto)
class MottoAdmin(admin.ModelAdmin):
    list_display = (
        'id',
        'text_preview_az',
        'text_preview_en',
        'text_preview_ru',
    )
    list_display_links = None
    search_fields = ('text_az', 'text_en', 'text_ru')
    list_per_page = 25
    
    fieldsets = (
        ('AzÉ™rbaycan', {
            'fields': ('text_az',)
        }),
        ('English', {
            'fields': ('text_en',)
        }),
        ('Ğ ÑƒÑÑĞºĞ¸Ğ¹', {
            'fields': ('text_ru',)
        }),
    )
    
    def text_preview_az(self, obj):
        url = reverse('admin:projects_motto_change', args=[obj.pk])
        preview = obj.text_az[:100] + '...' if len(obj.text_az) > 100 else obj.text_az
        return format_html('<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; font-size: 14px;">ğŸ”— {}</a>', url, preview)
    text_preview_az.short_description = "Deviz (AZ)"
    text_preview_az.admin_order_field = 'text_az'
    
    def text_preview_en(self, obj):
        preview = obj.text_en[:100] + '...' if len(obj.text_en) > 100 else obj.text_en
        return preview if obj.text_en else "-"
    text_preview_en.short_description = "Deviz (EN)"
    text_preview_en.admin_order_field = 'text_en'
    
    def text_preview_ru(self, obj):
        preview = obj.text_ru[:100] + '...' if len(obj.text_ru) > 100 else obj.text_ru
        return preview if obj.text_ru else "-"
    text_preview_ru.short_description = "Deviz (RU)"
    text_preview_ru.admin_order_field = 'text_ru'

# Appeal (CV) 
@admin.register(Appeal)
class AppealAdmin(admin.ModelAdmin):
    list_display = (
        'candidate_info',
        'vacancy_info',
        'contact_info',
        'cv_download',
        'is_read',
        'read_status_badge',
        'created_at_formatted',
    )

    list_display_links = None
    list_editable = ('is_read',)
    list_filter = ('is_read', 'created_at', 'vacancy')
    readonly_fields = ('created_at', 'cv_preview')
    search_fields = (
        'full_name',
        'email',
        'phone_number',
        'vacancy__title_az',
        'vacancy__title_en',
        'vacancy__title_ru',
    )
    ordering = ('-created_at',)
    list_per_page = 25
    date_hierarchy = 'created_at'

    fieldsets = (
        ('Vakansiya', {
            'fields': ('vacancy',)
        }),
        ('NamizÉ™d MÉ™lumatlarÄ±', {
            'fields': ('full_name', 'email', 'phone_number')
        }),
        ('CV FaylÄ±', {
            'fields': ('cv', 'cv_preview')
        }),
        ('Status', {
            'fields': ('is_read',)
        }),
        ('Tarix', {
            'fields': ('created_at',)
        }),
    )

    def candidate_info(self, obj):
        """NamizÉ™d mÉ™lumatlarÄ±nÄ± sÉ™liqÉ™li ÅŸÉ™kildÉ™ gÃ¶stÉ™rir"""
        detail_url = reverse('admin:projects_appeal_change', args=[obj.pk])
        name = obj.full_name or "Ad Soyad yoxdur"
        
        return format_html(
            '<div style="padding: 8px 0;">'
            '<a href="{}" style="color: #417690; text-decoration: none; font-weight: 600; '
            'font-size: 15px; display: block; line-height: 1.4;">'
            'ğŸ‘¤ {}</a>'
            '</div>',
            detail_url,
            name
        )
    candidate_info.short_description = "NamizÉ™d"
    candidate_info.admin_order_field = 'full_name'

    def vacancy_info(self, obj):
        """Vakansiya mÉ™lumatlarÄ±nÄ± sÉ™liqÉ™li ÅŸÉ™kildÉ™ gÃ¶stÉ™rir"""
        if obj.vacancy:
            vacancy_url = reverse('admin:projects_vacancy_change', args=[obj.vacancy.pk])
            detail_url = reverse('admin:projects_appeal_change', args=[obj.pk])
            
            return format_html(
                '<div style="padding: 8px 0;">'
                '<a href="{}" style="color: #417690; text-decoration: none; font-weight: 500; '
                'font-size: 14px; display: block; margin-bottom: 4px; line-height: 1.4;">'
                'ğŸ’¼ {}</a>'
                '<a href="{}" style="color: #6c757d; text-decoration: none; font-size: 11px; '
                'opacity: 0.8;">â†’ Vakansiyaya bax</a>'
                '</div>',
                detail_url,
                obj.vacancy.title_az[:50] + ('...' if len(obj.vacancy.title_az) > 50 else ''),
                vacancy_url
            )
        return format_html('<span style="color: #999; font-size: 13px;">Vakansiya yoxdur</span>')
    vacancy_info.short_description = "Vakansiya"
    vacancy_info.admin_order_field = 'vacancy__title_az'

    def contact_info(self, obj):
        """ÆlaqÉ™ mÉ™lumatlarÄ±nÄ± sÉ™liqÉ™li ÅŸÉ™kildÉ™ gÃ¶stÉ™rir"""
        contact_items = []
        
        if obj.email:
            contact_items.append(
                format_html(
                    '<div style="margin-bottom: 4px;">'
                    '<span style="color: #666; font-size: 12px;">âœ‰ï¸</span> '
                    '<a href="mailto:{}" style="color: #417690; text-decoration: none; '
                    'font-size: 13px;">{}</a>'
                    '</div>',
                    obj.email,
                    obj.email[:30] + ('...' if len(obj.email) > 30 else '')
                )
            )
        
        if obj.phone_number:
            contact_items.append(
                format_html(
                    '<div>'
                    '<span style="color: #666; font-size: 12px;">ğŸ“</span> '
                    '<span style="color: #333; font-size: 13px;">{}</span>'
                    '</div>',
                    obj.phone_number
                )
            )
        
        if not contact_items:
            return format_html('<span style="color: #999; font-size: 12px;">ÆlaqÉ™ mÉ™lumatÄ± yoxdur</span>')
        
        return format_html(
            '<div style="padding: 8px 0; line-height: 1.6;">{}</div>',
            format_html(''.join(contact_items))
        )
    contact_info.short_description = "ÆlaqÉ™"

    def cv_download(self, obj):
        """CV faylÄ±nÄ± sÉ™liqÉ™li ÅŸÉ™kildÉ™ gÃ¶stÉ™rir"""
        detail_url = reverse('admin:projects_appeal_change', args=[obj.pk])
        
        if obj.cv:
            file_name = obj.cv.name.split('/')[-1]
            file_size = obj.cv.size if hasattr(obj.cv, 'size') else None
            size_text = f"{round(file_size / 1024, 1)} KB" if isinstance(file_size, (int, float)) else "N/A"
            
            return format_html(
                '<div style="padding: 8px 0;">'
                '<a href="{}" target="_blank" '
                'style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); '
                'color: white; padding: 8px 14px; border-radius: 6px; text-decoration: none; '
                'font-size: 12px; font-weight: 600; display: inline-block; margin-bottom: 4px; '
                'box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;">'
                'ğŸ“ CV Endir</a>'
                '<div style="color: #666; font-size: 11px; margin-top: 4px;">'
                'ğŸ“„ {} <span style="opacity: 0.7;">({})</span>'
                '</div>'
                '</div>',
                obj.cv.url,
                file_name[:25] + ('...' if len(file_name) > 25 else ''),
                size_text
            )
        
        return format_html(
            '<div style="padding: 8px 0;">'
            '<a href="{}" style="color: #999; text-decoration: none; font-size: 12px;">'
            'CV faylÄ± yoxdur</a>'
            '</div>',
            detail_url
        )
    cv_download.short_description = "CV FaylÄ±"

    def read_status_badge(self, obj):
        """Oxunma statusunu badge ÅŸÉ™klindÉ™ gÃ¶stÉ™rir"""
        if obj.is_read:
            return format_html(
                '<div style="padding: 8px 0;">'
                '<span style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); '
                'color: white; padding: 6px 12px; border-radius: 8px; font-size: 11px; '
                'font-weight: 600; display: inline-block; box-shadow: 0 2px 4px rgba(40,167,69,0.3);">'
                'âœ“ Oxunub</span>'
                '</div>'
            )
        return format_html(
            '<div style="padding: 8px 0;">'
            '<span style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); '
            'color: white; padding: 6px 12px; border-radius: 8px; font-size: 11px; '
            'font-weight: 600; display: inline-block; box-shadow: 0 2px 4px rgba(220,53,69,0.3);">'
            'ğŸ”´ OxunmayÄ±b</span>'
            '</div>'
        )
    read_status_badge.short_description = "Status"
    read_status_badge.admin_order_field = 'is_read'

    def created_at_formatted(self, obj):
        """Tarixi sÉ™liqÉ™li formatda gÃ¶stÉ™rir"""
        if obj.created_at:
            date_str = obj.created_at.strftime('%d.%m.%Y')
            time_str = obj.created_at.strftime('%H:%M')
            return format_html(
                '<div style="padding: 8px 0;">'
                '<div style="color: #333; font-size: 13px; font-weight: 500; margin-bottom: 2px;">{}</div>'
                '<div style="color: #999; font-size: 11px;">{}</div>'
                '</div>',
                date_str,
                time_str
            )
        return "-"
    created_at_formatted.short_description = "Tarix"
    created_at_formatted.admin_order_field = 'created_at'

    def cv_preview(self, obj):
        if obj.cv:
            file_name = obj.cv.name.split('/')[-1]
            file_size = obj.cv.size if hasattr(obj.cv, 'size') else None

            return format_html(
                '<div style="padding:12px;background:#e3f2fd;border-radius:4px;'
                'border-left:3px solid #2196f3;">'
                '<span style="color:#1976d2;font-weight:500;">ğŸ“„ {}</span> '
                '<span style="color:#666;font-size:12px;">({} KB)</span>'
                '<a href="{}" target="_blank" '
                'style="color:#2196f3;text-decoration:none;margin-left:8px;font-weight:500;">'
                'ğŸ“¥ Endir</a>'
                '</div>',
                file_name,
                round(file_size / 1024, 2) if isinstance(file_size, (int, float)) else 'N/A',
                obj.cv.url
            )
        return "-"

    cv_preview.short_description = "CV Ã–nizlÉ™mÉ™"


# Statistic
@admin.register(Statistic)
class StatisticAdmin(admin.ModelAdmin):
    list_display = (
        'id',
        'value_one',
        'value_two',
        'value_three',
    )
    list_display_links = ('id',)
    fieldsets = (
        ('Statistikalar', {
            'fields': (
                'value_one',
                'value_two',
                'value_three',
            ),
        }),
    )


# Admin Site Customization
admin.site.site_header = "Conco Admin Panel"
admin.site.site_title = "Conco Admin"
admin.site.index_title = "Admin Paneli idarÉ™etmÉ™ sistemi"
